{"version":3,"file":"ajax_canvas_field.js","sources":["ajax_canvas_field.js"],"sourcesContent":["!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.AjaxCanvasField=e():t.AjaxCanvasField=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\".\",i(i.s=3)}([function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.Point=class{constructor({x:t,y:e,color:i,id:s}){this.x=t,this.y=e,this.color=i,this.offset=3.5,this.id=s}serialize(){const{x:t,y:e,color:i}=this;return{x_value:t,y_value:e,color:i}}toPath(){const{x:t,y:e,offset:i}=this;let s=new Path2D;return s.arc(t-i,e-i,2*i,0,2*Math.PI),s}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(0);e.PostProcessingRequest=class{constructor({points:t}){this.points=t.map(t=>new s.Point(t))}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.default=class{constructor(t){this.canvas=t,this.context=t.getContext(\"2d\")}drawPoint(t){const e=t.toPath();return this.context.fillStyle=t.color,this.context.fill(e,\"nonzero\"),this.context.stroke(e),!0}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}},function(t,e,i){\"use strict\";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,\"__esModule\",{value:!0});const n=i(0);e.Point=n.Point;const o=i(1);e.PostProcessingRequest=o.PostProcessingRequest;const r=s(i(4));e.ReadOnlyField=r.default;const c=s(i(5));e.EditableField=c.default},function(t,e,i){\"use strict\";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,\"__esModule\",{value:!0});const n=s(i(2)),o=i(1);e.default=class extends n.default{constructor(t){super(t),this.requests={},this.activeRequestId=null,this.importData(this.canvas.dataset.props),this.initializeRowClickListeners(),this.highlightActiveRow()}setActiveRequest(t){if(this.activeRequestId===Number(t))return;const e=this.requests[t];if(!e)throw new Error(`Request with id=${t} not found in data`);return this.activeRequestId=Number(t),this.render(),e}highlightActiveRow(){if(!this.activeRequestId)return;const t=document.getElementById(`request_row_${this.activeRequestId}`);document.querySelectorAll(\".request-row\").forEach(e=>{e.classList.toggle(\"is-active\",e===t)})}initializeRowClickListeners(){Object.keys(this.requests).forEach(t=>{const e=document.getElementById(`request_row_${t}`);e&&e.addEventListener(\"click\",e=>{e.preventDefault(),this.setActiveRequest(t),this.highlightActiveRow()})})}render(){this.clear();const t=this.requests[this.activeRequestId];t&&t.points.forEach(t=>{this.drawPoint(t)})}importData(t){const{requests:e}=JSON.parse(t);this.requests=e.reduce((t,e)=>(t[e.id]=new o.PostProcessingRequest(e),t),{}),this.setActiveRequest(Number(Object.keys(this.requests)[0]))}}},function(t,e,i){\"use strict\";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,\"__esModule\",{value:!0});const n=i(0),o=s(i(2));e.default=class extends o.default{constructor(t){super(t);const{props:e}=t.dataset;this.points=[],this.handleClick=this.handleClick.bind(this),e&&this.importData(e)&&this.initClickHandlers()}importData(t){const{variants:e}=JSON.parse(t);return this.variants=e,!!e}initClickHandlers(){const t=this.canvas,{left:e,middle:i,right:s}=this.variants;e.active&&t.addEventListener(\"click\",this.handleClick,!1),i.active&&t.addEventListener(\"auxclick\",this.handleClick,!1),s.active&&t.addEventListener(\"contextmenu\",this.handleClick,!1)}handleClick(t){if(t.preventDefault(),\"contextmenu\"===t.type)return;const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,n=this.context,o=this.points.findIndex(t=>n.isPointInPath(t.toPath(),i,s,\"nonzero\"));-1===o?this.addPoint({x:i,y:s,e:t}):this.removePoint(this.points[o])}colorFromEvent(t){const{left:e,middle:i,right:s}=this.variants;switch(t.which){case 1:return e.color;case 2:return i.color;case 3:return s.color;default:return\"#ff0000\"}}addPoint({x:t,y:e,e:i,color:s}){s=s||this.colorFromEvent(i);const o=new n.Point({x:t,y:e,color:s});return this.points.push(o),this.drawPoint(o),!0}removePoint(t){const{x:e,y:i}=t,s=this.points.findIndex(t=>t.x===e&&t.y===i);return!!s&&(this.points.splice(s,1),!0)}serialize(){return this.points.map(t=>t.serialize())}render(){this.clear();const t=this.context;this.points.forEach(e=>{const i=e.toPath();t.fillStyle=e.color,t.fill(i,\"nonzero\"),t.stroke(i)})}}}])});"],"mappings":"AAAA","sourceRoot":""}